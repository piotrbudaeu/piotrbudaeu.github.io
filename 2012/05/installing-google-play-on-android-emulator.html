<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content="0; url=http://www.piotrbuda.me/2012/05/installing-google-play-on-android-emulator.html">
  <link rel="canonical" href="http://www.piotrbuda.me/2012/05/installing-google-play-on-android-emulator.html" />
  <title>Installing Google Play on Android Emulator | Software Development Ramblings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The problemI wanted to install Google Play on emulator. Problem is no guide on the net could tell me precisely how to do this. I’m not sure why, it seemed that they worked with old Android Market (pre">
<meta property="og:type" content="article">
<meta property="og:title" content="Installing Google Play on Android Emulator">
<meta property="og:url" content="http://www.piotrbuda.eu/2012/05/installing-google-play-on-android-emulator.html">
<meta property="og:site_name" content="Software Development Ramblings">
<meta property="og:description" content="The problemI wanted to install Google Play on emulator. Problem is no guide on the net could tell me precisely how to do this. I’m not sure why, it seemed that they worked with old Android Market (pre">
<meta property="og:image" content="/images/avdsettings.png">
<meta property="og:image" content="/images/emulator.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Installing Google Play on Android Emulator">
<meta name="twitter:description" content="The problemI wanted to install Google Play on emulator. Problem is no guide on the net could tell me precisely how to do this. I’m not sure why, it seemed that they worked with old Android Market (pre">
<meta name="twitter:creator" content="@piotrbuda">
  
    <link rel="alternative" href="/atom.xml" title="Software Development Ramblings" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
    <link href="http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700|Ubuntu:400,700,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-62603909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Software Development Ramblings</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Java, Scala and Android</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-github-link" class="nav-icon" href="https://github.com/pbuda" target="_blank"></a>
        <a id="nav-linkedin-link" class="nav-icon" href="https://pl.linkedin.com/in/piotrbuda" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/piotrbuda" target="_blank"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://www.piotrbuda.eu"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-installing-google-play-on-android-emulator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/05/installing-google-play-on-android-emulator.html" class="article-date">
  <time datetime="2012-05-02T19:40:00.000Z" itemprop="datePublished">2012-05-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Installing Google Play on Android Emulator
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="The_problem">The problem</h3><p>I wanted to install Google Play on emulator. Problem is no guide on the net could tell me precisely how to do this. I’m not sure why, it seemed that they worked with old Android Market (pre version 3 era) or at least people shown some screenshots of that but I couldn’t make it work at home.</p>
<p>The difference was that I tried to install Google Play on an Ice Cream Sandwitch emulator (API level 15) and it always failed.</p>
<h3 id="First_attempts">First attempts</h3><p>I first found <a href="http://blog.varunkumar.me/2010/11/how-to-install-android-market-in-google.html" target="_blank" rel="external">this site</a>. I tried setting up everything from there but I just couldn’t make it work. Possible because their Vending.apk couldn’t start, I have no clue. Then I found <a href="http://www.tech-recipes.com/rx/10004/accessing-android-market-from-android-sdk/" target="_blank" rel="external">this site</a> and I somehow managed to install Vending.apk on emulator using this guide, but I couldn’t reproduce that.</p>
<p>One of the problems with those guides (which made me spend a lot of time on something useless) was that both these guides made me delete two files from AVD: cache.img and userdata-qemu.img. Why? Apparently when you wanted to restart emulator, these files were responsible for reinitialization of emulator to it’s starting state (like full wipe/factory reset). I tried and tried and I always ended up without my changes.</p>
<h3 id="New_Hope">New Hope</h3><p>After that I found that there is a snapshot option in AVD configuration window so I just checked it and finally I was able to see last state of emulator. Maybe it’s not perfect - it works like hibernation on your laptop - but it works and after a whole day of fight it was enough.</p>
<p>I then though why do I install some obsolete Vending.apk and GoogleServicesFramework.apk? Why can’t I have a new one there? So I connected my phone and pulled those apks from it. Of course it didn’t work, but I was not sure why. But I remembered something - <del>CyanogenMod has Google apps packed in a zip</del> (UPDATE: CyanogenMod does no longer host Google Apps, but you can <a href="http://goo.im/gapps/" target="_blank" rel="external">find them here</a>! So I downloaded their package and extracted everything I needed - Vending.apk and GoogleServicesFramework.apk. But it was not enough.</p>
<p>So I had an AVD set up with snapshots enabled and I proceeded to installing my new apks - full script will be posted at the end.</p>
<pre><code><span class="number">1.</span> You have <span class="keyword">to</span> remount system partition <span class="keyword">in</span> <span class="command">read</span>-<span class="command">write</span> mode.
<span class="number">2.</span> Then <span class="keyword">it</span>'s necessary <span class="keyword">to</span> allow writing <span class="keyword">to</span> /system/app directory
<span class="number">3.</span> After <span class="keyword">that</span> <span class="keyword">is</span> done just push apks <span class="keyword">to</span> /system/app/. (notice <span class="keyword">the</span> dot <span class="keyword">at</span> <span class="keyword">the</span> <span class="keyword">end</span>) 
<span class="number">4.</span> Just <span class="keyword">for</span> <span class="keyword">the</span> sake <span class="keyword">of</span> other guides I also remove /system/app/SdkSetup* (both apk <span class="keyword">and</span> odex)
</code></pre><p>Voila! Google Play is installed on emulator! But it still doesn’t work. In order for it to start working, you need an account - Google account. This step also cost me some time. My AVD was based on Android 4.0.3, not the Google APIs one. So I changed it and… still nothing.</p>
<p>Apparently in recent releases Google decided to decouple their account provider from the OS so they have a separate apk that allows configuration of Google accounts - it’s called GoogleLoginService.apk. Pushing this to emulator solved all the problems - you don’t even need Google APIs (you can set up against Android 4.0.3 option). Now when you enter Play Store you get prompted for an account and it works!</p>
<h3 id="Conclusion">Conclusion</h3><p>After two days of trying I finally was able to launch and browse Google Play Store on an Android emulator with Ice Cream Sandwitch. Phew.</p>
<p>Command I use to start my emulator<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">emulator</span> -avd am -partition-size <span class="number">200</span> -<span class="built_in">no</span>-audio -<span class="built_in">no</span>-boot-anim</span><br></pre></td></tr></table></figure><br>Full script (assumes you have created and started your AVD)<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb shell mount -o remount,rw -t yaffs2 /dev/block/mtdblock<span class="number">0</span> /<span class="keyword">system</span></span><br><span class="line">adb shell <span class="keyword">chmod</span> <span class="number">777</span> /<span class="keyword">system</span>/app</span><br><span class="line">adb <span class="keyword">push</span> GoogleLoginService.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb <span class="keyword">push</span> GoogleServicesFramework.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb <span class="keyword">push</span> Vending.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb shell rm /<span class="keyword">system</span>/app/SdkSetup*</span><br></pre></td></tr></table></figure><br>That script will work as long as you run it from a dir in which you have all the necessary apks. Of course you have to have your PATH environment variable set correctly (so that all those commands are actually accessible) but I suppose you know that already.</p>
<h3 id="Settings_of_the_AVD">Settings of the AVD</h3><img src="/images/avdsettings.png" title="Settings of the AVD">
<h3 id="Working_Google_Play_Store">Working Google Play Store</h3><img src="/images/emulator.png" title="Working Google Play Store">
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.piotrbuda.eu/2012/05/installing-google-play-on-android-emulator.html" data-id="ci9axxg6p001b2l1vriwvk3r4" class="article-share-link">Share</a>
      
        <a href="http://www.piotrbuda.eu/2012/05/installing-google-play-on-android-emulator.html#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2012/06/trying-to-solve-error-491-in-play-store-on-android-emulator.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Trying to solve Error 491 in Play Store on Android Emulator
        
      </div>
    </a>
  
  
    <a href="/2012/05/getting-auth-token-on-an-android-device.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Getting auth token on an Android device</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2013/05/microsoft-natural-ergonomic-keyboard-4000.html">Microsoft Natural Ergonomic Keyboard 4000</a>
          </li>
        
          <li>
            <a href="/2013/04/scalawebsocket.html">ScalaWebSocket</a>
          </li>
        
          <li>
            <a href="/2013/02/trying-to-deploy-scala-app-on-openshift.html">Trying to deploy Scala app on OpenShift</a>
          </li>
        
          <li>
            <a href="/2013/02/angularjs-directive-for-password-matching.html">Angular directive for password matching</a>
          </li>
        
          <li>
            <a href="/2013/02/my-first-month-at-softwaremill.html">My first month at SoftwareMill</a>
          </li>
        
          <li>
            <a href="/2012/12/scala-and-android-asynctask-implementation-problem.html">Scala and Android: AsyncTask implementation problem</a>
          </li>
        
          <li>
            <a href="/2012/10/warsjawa-2012.html">Warsjawa 2012</a>
          </li>
        
          <li>
            <a href="/2012/10/scala-case-classes-and-annotations-part-2.html">Scala case classes and annotations, part 2</a>
          </li>
        
          <li>
            <a href="/2012/10/scala-case-classes-and-annotations-part-1.html">Scala case classes and annotations, part 1</a>
          </li>
        
          <li>
            <a href="/2012/09/function-programming-principles-in-scala-course-week-one.html">Function Programming Principles in Scala course - week one</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/android/google-play-store/">google play store</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hardware/">hardware</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/api/" style="font-size: 10px;">api</a><a href="/tags/cloud/" style="font-size: 10px;">cloud</a><a href="/tags/google-play/" style="font-size: 10px;">google play</a><a href="/tags/openshift/" style="font-size: 10px;">openshift</a><a href="/tags/play/" style="font-size: 10px;">play</a><a href="/tags/play-store-api/" style="font-size: 10px;">play store api</a><a href="/tags/sbt/" style="font-size: 10px;">sbt</a><a href="/tags/scala/" style="font-size: 20px;">scala</a><a href="/tags/spray/" style="font-size: 10px;">spray</a><a href="/tags/store/" style="font-size: 10px;">store</a><a href="/tags/websocket/" style="font-size: 10px;">websocket</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Piotr Buda<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="https://github.com/jr0cket/hexo-theme-landscape-jr0cket" target="_blank">landscape-jr0cket</a> theme.
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'piotrbuda';
  
  var disqus_url = 'http://www.piotrbuda.eu/2012/05/installing-google-play-on-android-emulator.html';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

<div id="scroll2top" style="position:fixed;bottom:150px;right:50px;cursor: pointer;Z-index:9999">
<a title="返回顶部" href="#"><img src="/scroll2top/scrollup.png"/></a>
</div>
<script src="/scroll2top/scroll2top.js"></script>



  </div>
</body>
</html>